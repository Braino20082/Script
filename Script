-- StarterGui > LocalScript
local Players = game:GetService("Players")
local UserInput = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- alte GUIs löschen
for _,v in ipairs(playerGui:GetChildren()) do
	if v.Name == "CustomMainUI" or v.Name == "PlayerInfoUI" then v:Destroy() ---------------------------
-- Spieler Panel Inhalte (Player List with Search)
---------------------------
do
	local panel = panels["Spieler"]
	
	-- Search Box
	local searchBox = Instance.new("TextBox")
	searchBox.Size = UDim2.new(0.9,0,0.08,0)
	searchBox.Position = UDim2.new(0.05,0,0.05,0)
	searchBox.PlaceholderText = "Spieler suchen..."
	searchBox.Text = ""
	searchBox.Font = Enum.Font.SourceSans
	searchBox.TextScaled = true
	searchBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
	searchBox.TextColor3 = Color3.new(1,1,1)
	searchBox.PlaceholderColor3 = Color3.fromRGB(150,150,150)
	searchBox.Parent = panel
	
	local searchCorner = Instance.new("UICorner")
	searchCorner.CornerRadius = UDim.new(0,4)
	searchCorner.Parent = searchBox
	
	-- Player List ScrollFrame
	local playerListFrame = Instance.new("ScrollingFrame")
	playerListFrame.Size = UDim2.new(0.9,0,0.8,0)
	playerListFrame.Position = UDim2.new(0.05,0,0.15,0)
	playerListFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
	playerListFrame.BorderSizePixel = 0
	playerListFrame.ScrollBarThickness = 8
	playerListFrame.Parent = panel
	
	local listCorner = Instance.new("UICorner")
	listCorner.CornerRadius = UDim.new(0,4)
	listCorner.Parent = playerListFrame
	
	local listLayout = Instance.new("UIListLayout")
	listLayout.SortOrder = Enum.SortOrder.Name
	listLayout.Padding = UDim.new(0,2)
	listLayout.Parent = playerListFrame
	
	local function updatePlayerList(filter)
		for _,child in pairs(playerListFrame:GetChildren()) do
			if child:IsA("TextButton") then
				child:Destroy()
			end
		end
		
		for _,plr in pairs(Players:GetPlayers()) do
			if plr ~= player then
				local name = plr.Name:lower()
				local displayName = (plr.DisplayName or plr.Name):lower()
				filter = filter and filter:lower() or ""
				
				if filter == "" or name:find(filter) or displayName:find(filter) then
					local playerBtn = Instance.new("TextButton")
					playerBtn.Size = UDim2.new(1,0,0,30)
					playerBtn.Text = plr.DisplayName .. " (@" .. plr.Name .. ")"
					playerBtn.Font = Enum.Font.SourceSans
					playerBtn.TextScaled = true
					playerBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
					playerBtn.TextColor3 = Color3.new(1,1,1)
					playerBtn.Parent = playerListFrame
					
					local playerBtnCorner = Instance.new("UICorner")
					playerBtnCorner.CornerRadius = UDim.new(0,2)
					playerBtnCorner.Parent = playerBtn
					
					playerBtn.MouseButton1Click:Connect(function()
						selectedPlayer = plr
						createPlayerInfoGUI(plr)
					end)
					
					playerBtn.MouseEnter:Connect(function()
						playerBtn.BackgroundColor3 = Color3.fromRGB(80,80,120)
					end)
					
					playerBtn.MouseLeave:Connect(function()
						playerBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
					end)
				end
			end
		end
		
		playerListFrame.CanvasSize = UDim2.new(0,0,0,listLayout.AbsoluteContentSize.Y)
	end
	
	searchBox.Changed:Connect(function(prop)
		if prop == "Text" then
			updatePlayerList(searchBox.Text)
		end
	end)
	
	-- Update player list when players join/leave
	Players.PlayerAdded:Connect(function()
		updatePlayerList(searchBox.Text)
	end)
	
	Players.PlayerRemoving:Connect(function()
		updatePlayerList(searchBox.Text)
	end)
	
	-- Initial load
	updatePlayerList("")
end
end

-- Root ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CustomMainUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Hauptframe
local app = Instance.new("Frame")
app.Size = UDim2.new(0.25,0,0.25,0)
app.Position = UDim2.new(0.05,0,0.05,0)
app.BackgroundColor3 = Color3.fromRGB(28,28,28)
app.BorderSizePixel = 0
app.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,8)
corner.Parent = app

-- Dragbar
local dragBar = Instance.new("Frame")
dragBar.Size = UDim2.new(1,0,0.08,0)
dragBar.BackgroundColor3 = Color3.fromRGB(40,40,40)
dragBar.BorderSizePixel = 0
dragBar.Parent = app

local dragCorner = Instance.new("UICorner")
dragCorner.CornerRadius = UDim.new(0,8)
dragCorner.Parent = dragBar

local dragLabel = Instance.new("TextLabel")
dragLabel.Size = UDim2.new(0.9,0,1,0)
dragLabel.BackgroundTransparency = 1
dragLabel.Text = "Custom Menu - Enhanced"
dragLabel.Font = Enum.Font.SourceSansBold
dragLabel.TextColor3 = Color3.new(1,1,1)
dragLabel.TextScaled = true
dragLabel.Parent = dragBar

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0.05,0,0.8,0)
closeBtn.Position = UDim2.new(0.94,0,0.1,0)
closeBtn.Text = "X"
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextScaled = true
closeBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
closeBtn.TextColor3 = Color3.new(1,1,1)
closeBtn.Parent = dragBar

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0,4)
closeBtnCorner.Parent = closeBtn

closeBtn.MouseButton1Click:Connect(function()
	app.Visible = false
end)

-- Sidebar
local sidebar = Instance.new("Frame")
sidebar.Size = UDim2.new(0.25,0,0.92,0)
sidebar.Position = UDim2.new(0,0,0.08,0)
sidebar.BackgroundColor3 = Color3.fromRGB(36,36,36)
sidebar.BorderSizePixel = 0
sidebar.Parent = app

-- Content
local content = Instance.new("Frame")
content.Size = UDim2.new(0.75,0,0.92,0)
content.Position = UDim2.new(0.25,0,0.08,0)
content.BackgroundColor3 = Color3.fromRGB(24,24,24)
content.BorderSizePixel = 0
content.Parent = app

-- Panels
local panels = {}
local buttonNames = {"Player","Spieler","ESP","Voice"}
local selectedPlayer = nil

for i,name in ipairs(buttonNames) do
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.9,0,0.1,0)
	btn.Position = UDim2.new(0.05,0,(i-1)*0.12,0)
	btn.Text = name
	btn.Font = Enum.Font.SourceSansBold
	btn.TextScaled = true
	btn.BackgroundColor3 = Color3.fromRGB(58,58,58)
	btn.TextColor3 = Color3.new(1,1,1)
	btn.Parent = sidebar

	local btnCorner = Instance.new("UICorner")
	btnCorner.CornerRadius = UDim.new(0,4)
	btnCorner.Parent = btn

	local panel = Instance.new("Frame")
	panel.Size = UDim2.new(1,-20,1,-20)
	panel.Position = UDim2.new(0,10,0,10)
	panel.BackgroundTransparency = 1
	panel.Visible = false
	panel.Parent = content
	panels[name] = panel

	btn.MouseButton1Click:Connect(function()
		for _,p in pairs(panels) do p.Visible = false end
		panel.Visible = true
		-- Button highlight
		for _,otherBtn in pairs(sidebar:GetChildren()) do
			if otherBtn:IsA("TextButton") then
				otherBtn.BackgroundColor3 = Color3.fromRGB(58,58,58)
			end
		end
		btn.BackgroundColor3 = Color3.fromRGB(80,80,150)
	end)
end
if panels["Player"] then 
	panels["Player"].Visible = true 
	sidebar:GetChildren()[1].BackgroundColor3 = Color3.fromRGB(80,80,150)
end

---------------------------
-- Funktionen
---------------------------

-- Fly Variablen
local flying = false
local flySpeed = 50
local flyVelocity

local function toggleFly(state)
	if state then
		if not flyVelocity then
			local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
			if root then
				flyVelocity = Instance.new("BodyVelocity")
				flyVelocity.MaxForce = Vector3.new(1e5,1e5,1e5)
				flyVelocity.Velocity = Vector3.zero
				flyVelocity.Parent = root
			end
		end
		flying = true
	else
		flying = false
		if flyVelocity then flyVelocity:Destroy() flyVelocity = nil end
	end
end

-- Noclip
local noclip = false
RunService.RenderStepped:Connect(function()
	if noclip and player.Character then
		for _,part in pairs(player.Character:GetChildren()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

-- ESP Hitbox / Name with color options
local espEnabled = false
local nameEnabled = false
local hitboxColor = Color3.fromRGB(255,0,0)
local nameColor = Color3.fromRGB(0,255,0)

local function updateESP(state)
	espEnabled = state
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character then
			local root = plr.Character:FindFirstChild("HumanoidRootPart")
			if root then
				if state then
					if not root:FindFirstChild("HitboxESP") then
						local box = Instance.new("BoxHandleAdornment")
						box.Name = "HitboxESP"
						box.Size = root.Size * 3
						box.Adornee = root
						box.AlwaysOnTop = true
						box.Transparency = 0.8
						box.Color3 = hitboxColor
						box.Parent = root
					else
						root.HitboxESP.Color3 = hitboxColor
					end
				else
					if root:FindFirstChild("HitboxESP") then
						root.HitboxESP:Destroy()
					end
				end
			end
		end
	end
end

local function updateNames(state)
	nameEnabled = state
	for _,plr in ipairs(Players:GetPlayers()) do
		if plr ~= player and plr.Character and plr.Character:FindFirstChild("Head") then
			local head = plr.Character.Head
			if state then
				if not head:FindFirstChild("NameESP") then
					local tag = Instance.new("BillboardGui")
					tag.Name = "NameESP"
					tag.Size = UDim2.new(0,100,0,50)
					tag.AlwaysOnTop = true
					tag.Adornee = head
					tag.Parent = head
					local text = Instance.new("TextLabel")
					text.Size = UDim2.new(1,0,1,0)
					text.BackgroundTransparency = 1
					text.Text = plr.Name
					text.Font = Enum.Font.SourceSansBold
					text.TextScaled = true
					text.TextColor3 = nameColor
					text.Parent = tag
				else
					head.NameESP:GetChildren()[1].TextColor3 = nameColor
				end
			else
				if head:FindFirstChild("NameESP") then
					head.NameESP:Destroy()
				end
			end
		end
	end
end

-- Voice Fake "Unban"
local function showNotification(msg)
	StarterGui:SetCore("SendNotification", {
		Title = "Voice System",
		Text = msg,
		Duration = 3
	})
end

-- Player Actions
local function bangPlayer(targetPlayer, version)
	if not targetPlayer or not targetPlayer.Character or not player.Character then return end
	
	local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
	local playerRoot = player.Character:FindFirstChild("HumanoidRootPart")
	
	if targetRoot and playerRoot then
		local offset = version == "V2" and Vector3.new(0, 2, -3) or Vector3.new(0, 0, -3)
		playerRoot.CFrame = targetRoot.CFrame * CFrame.new(offset)
		showNotification("Bang " .. (version or "") .. " auf " .. targetPlayer.Name)
	end
end

local function teleportToPlayer(targetPlayer)
	if not targetPlayer or not targetPlayer.Character or not player.Character then return end
	
	local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
	local playerRoot = player.Character:FindFirstChild("HumanoidRootPart")
	
	if targetRoot and playerRoot then
		playerRoot.CFrame = targetRoot.CFrame * CFrame.new(0, 0, 5)
		showNotification("Teleportiert zu " .. targetPlayer.Name)
	end
end

local function watchPlayer(targetPlayer)
	if not targetPlayer or not targetPlayer.Character then return end
	
	workspace.CurrentCamera.CameraSubject = targetPlayer.Character:FindFirstChild("Humanoid")
	showNotification("Schaue " .. targetPlayer.Name .. " zu")
end

local function headsitPlayer(targetPlayer)
	if not targetPlayer or not targetPlayer.Character or not player.Character then return end
	
	local targetRoot = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
	local playerRoot = player.Character:FindFirstChild("HumanoidRootPart")
	
	if targetRoot and playerRoot then
		playerRoot.CFrame = targetRoot.CFrame * CFrame.new(0, 5, 0)
		showNotification("Sitze auf " .. targetPlayer.Name .. "'s Kopf")
	end
end

-- Fly + Player Speed
local playerSpeed = 16
RunService.RenderStepped:Connect(function()
	if player.Character and player.Character:FindFirstChild("Humanoid") then
		player.Character.Humanoid.WalkSpeed = playerSpeed
	end
	if flying and flyVelocity and player.Character then
		local root = player.Character:FindFirstChild("HumanoidRootPart")
		if root then
			local move = Vector3.zero
			if UserInput:IsKeyDown(Enum.KeyCode.W) then move = move + workspace.CurrentCamera.CFrame.LookVector end
			if UserInput:IsKeyDown(Enum.KeyCode.S) then move = move - workspace.CurrentCamera.CFrame.LookVector end
			if UserInput:IsKeyDown(Enum.KeyCode.A) then move = move - workspace.CurrentCamera.CFrame.RightVector end
			if UserInput:IsKeyDown(Enum.KeyCode.D) then move = move + workspace.CurrentCamera.CFrame.RightVector end
			if move.Magnitude == 0 then
				flyVelocity.Velocity = Vector3.new(0,0,0)
			else
				flyVelocity.Velocity = move.Unit * flySpeed
			end
		end
	end
end)

---------------------------
-- Player Panel Inhalte
---------------------------
do
	local panel = panels["Player"]

	local flyBtn = Instance.new("TextButton")
	flyBtn.Size = UDim2.new(0.4,0,0.08,0)
	flyBtn.Position = UDim2.new(0.05,0,0.05,0)
	flyBtn.Text = "Fly OFF"
	flyBtn.Font = Enum.Font.SourceSansBold
	flyBtn.TextScaled = true
	flyBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	flyBtn.TextColor3 = Color3.new(1,1,1)
	flyBtn.Parent = panel

	local flyCorner = Instance.new("UICorner")
	flyCorner.CornerRadius = UDim.new(0,4)
	flyCorner.Parent = flyBtn

	flyBtn.MouseButton1Click:Connect(function()
		if flying then
			toggleFly(false)
			flyBtn.Text = "Fly OFF"
			flyBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
		else
			toggleFly(true)
			flyBtn.Text = "Fly ON"
			flyBtn.BackgroundColor3 = Color3.fromRGB(50,150,50)
		end
	end)

	local noclipBtn = Instance.new("TextButton")
	noclipBtn.Size = UDim2.new(0.4,0,0.08,0)
	noclipBtn.Position = UDim2.new(0.5,0,0.05,0)
	noclipBtn.Text = "Noclip OFF"
	noclipBtn.Font = Enum.Font.SourceSansBold
	noclipBtn.TextScaled = true
	noclipBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	noclipBtn.TextColor3 = Color3.new(1,1,1)
	noclipBtn.Parent = panel

	local noclipCorner = Instance.new("UICorner")
	noclipCorner.CornerRadius = UDim.new(0,4)
	noclipCorner.Parent = noclipBtn

	noclipBtn.MouseButton1Click:Connect(function()
		noclip = not noclip
		noclipBtn.Text = noclip and "Noclip ON" or "Noclip OFF"
		noclipBtn.BackgroundColor3 = noclip and Color3.fromRGB(50,150,50) or Color3.fromRGB(70,70,70)
	end)

	-- Player Speed Slider
	local speedLabel = Instance.new("TextLabel")
	speedLabel.Size = UDim2.new(0.3,0,0.05,0)
	speedLabel.Position = UDim2.new(0.05,0,0.2,0)
	speedLabel.Text = "Speed: "..playerSpeed
	speedLabel.BackgroundTransparency = 1
	speedLabel.TextColor3 = Color3.new(1,1,1)
	speedLabel.Font = Enum.Font.SourceSansBold
	speedLabel.TextScaled = true
	speedLabel.Parent = panel

	local speedSlider = Instance.new("Frame")
	speedSlider.Size = UDim2.new(0.6,0,0.05,0)
	speedSlider.Position = UDim2.new(0.35,0,0.2,0)
	speedSlider.BackgroundColor3 = Color3.fromRGB(50,50,50)
	speedSlider.Parent = panel

	local speedSliderCorner = Instance.new("UICorner")
	speedSliderCorner.CornerRadius = UDim.new(0,2)
	speedSliderCorner.Parent = speedSlider

	local speedFill = Instance.new("Frame")
	speedFill.Size = UDim2.new((playerSpeed-16)/200,0,1,0)
	speedFill.BackgroundColor3 = Color3.fromRGB(0,255,255)
	speedFill.Parent = speedSlider

	local speedFillCorner = Instance.new("UICorner")
	speedFillCorner.CornerRadius = UDim.new(0,2)
	speedFillCorner.Parent = speedFill

	local draggingSpeed = false
	speedSlider.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			draggingSpeed = true
		end
	end)
	speedSlider.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			draggingSpeed = false
		end
	end)
	UserInput.InputChanged:Connect(function(input)
		if draggingSpeed and input.UserInputType == Enum.UserInputType.MouseMovement then
			local x = math.clamp(input.Position.X - speedSlider.AbsolutePosition.X, 0, speedSlider.AbsoluteSize.X)
			local ratio = x / speedSlider.AbsoluteSize.X
			playerSpeed = math.floor(16 + ratio * (200-16))
			speedFill.Size = UDim2.new(ratio,0,1,0)
			speedLabel.Text = "Speed: "..playerSpeed
		end
	end)

	-- Fly Speed Slider
	local flyLabel = Instance.new("TextLabel")
	flyLabel.Size = UDim2.new(0.3,0,0.05,0)
	flyLabel.Position = UDim2.new(0.05,0,0.3,0)
	flyLabel.Text = "FlySpeed: "..flySpeed
	flyLabel.BackgroundTransparency = 1
	flyLabel.TextColor3 = Color3.new(1,1,1)
	flyLabel.Font = Enum.Font.SourceSansBold
	flyLabel.TextScaled = true
	flyLabel.Parent = panel

	local flySlider = Instance.new("Frame")
	flySlider.Size = UDim2.new(0.6,0,0.05,0)
	flySlider.Position = UDim2.new(0.35,0,0.3,0)
	flySlider.BackgroundColor3 = Color3.fromRGB(50,50,50)
	flySlider.Parent = panel

	local flySliderCorner = Instance.new("UICorner")
	flySliderCorner.CornerRadius = UDim.new(0,2)
	flySliderCorner.Parent = flySlider

	local flyFill = Instance.new("Frame")
	flyFill.Size = UDim2.new(flySpeed/200,0,1,0)
	flyFill.BackgroundColor3 = Color3.fromRGB(255,255,0)
	flyFill.Parent = flySlider

	local flyFillCorner = Instance.new("UICorner")
	flyFillCorner.CornerRadius = UDim.new(0,2)
	flyFillCorner.Parent = flyFill

	local draggingFly = false
	flySlider.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			draggingFly = true
		end
	end)
	flySlider.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			draggingFly = false
		end
	end)
	UserInput.InputChanged:Connect(function(input)
		if draggingFly and input.UserInputType == Enum.UserInputType.MouseMovement then
			local x = math.clamp(input.Position.X - flySlider.AbsolutePosition.X, 0, flySlider.AbsoluteSize.X)
			local ratio = x / flySlider.AbsoluteSize.X
			flySpeed = math.floor(ratio*200)
			flyFill.Size = UDim2.new(ratio,0,1,0)
			flyLabel.Text = "FlySpeed: "..flySpeed
		end
	end)
end

---------------------------
-- Players Panel Inhalte
---------------------------
do
	local panel = panels["Players"]
	
	-- Search Box
	local searchBox = Instance.new("TextBox")
	searchBox.Size = UDim2.new(0.9,0,0.08,0)
	searchBox.Position = UDim2.new(0.05,0,0.05,0)
	searchBox.PlaceholderText = "Spieler suchen..."
	searchBox.Text = ""
	searchBox.Font = Enum.Font.SourceSans
	searchBox.TextScaled = true
	searchBox.BackgroundColor3 = Color3.fromRGB(50,50,50)
	searchBox.TextColor3 = Color3.new(1,1,1)
	searchBox.PlaceholderColor3 = Color3.fromRGB(150,150,150)
	searchBox.Parent = panel
	
	local searchCorner = Instance.new("UICorner")
	searchCorner.CornerRadius = UDim.new(0,4)
	searchCorner.Parent = searchBox
	
	-- Player List ScrollFrame
	local playerListFrame = Instance.new("ScrollingFrame")
	playerListFrame.Size = UDim2.new(0.9,0,0.8,0)
	playerListFrame.Position = UDim2.new(0.05,0,0.15,0)
	playerListFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
	playerListFrame.BorderSizePixel = 0
	playerListFrame.ScrollBarThickness = 8
	playerListFrame.Parent = panel
	
	local listCorner = Instance.new("UICorner")
	listCorner.CornerRadius = UDim.new(0,4)
	listCorner.Parent = playerListFrame
	
	local listLayout = Instance.new("UIListLayout")
	listLayout.SortOrder = Enum.SortOrder.Name
	listLayout.Padding = UDim.new(0,2)
	listLayout.Parent = playerListFrame
	
	local function updatePlayerList(filter)
		for _,child in pairs(playerListFrame:GetChildren()) do
			if child:IsA("TextButton") then
				child:Destroy()
			end
		end
		
		for _,plr in pairs(Players:GetPlayers()) do
			if plr ~= player then
				local name = plr.Name:lower()
				local displayName = (plr.DisplayName or plr.Name):lower()
				filter = filter and filter:lower() or ""
				
				if filter == "" or name:find(filter) or displayName:find(filter) then
					local playerBtn = Instance.new("TextButton")
					playerBtn.Size = UDim2.new(1,0,0,30)
					playerBtn.Text = plr.DisplayName .. " (@" .. plr.Name .. ")"
					playerBtn.Font = Enum.Font.SourceSans
					playerBtn.TextScaled = true
					playerBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
					playerBtn.TextColor3 = Color3.new(1,1,1)
					playerBtn.Parent = playerListFrame
					
					local playerBtnCorner = Instance.new("UICorner")
					playerBtnCorner.CornerRadius = UDim.new(0,2)
					playerBtnCorner.Parent = playerBtn
					
					playerBtn.MouseButton1Click:Connect(function()
						selectedPlayer = plr
						createPlayerInfoGUI(plr)
					end)
					
					playerBtn.MouseEnter:Connect(function()
						playerBtn.BackgroundColor3 = Color3.fromRGB(80,80,120)
					end)
					
					playerBtn.MouseLeave:Connect(function()
						playerBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
					end)
				end
			end
		end
		
		playerListFrame.CanvasSize = UDim2.new(0,0,0,listLayout.AbsoluteContentSize.Y)
	end
	
	searchBox.Changed:Connect(function(prop)
		if prop == "Text" then
			updatePlayerList(searchBox.Text)
		end
	end)
	
	-- Update player list when players join/leave
	Players.PlayerAdded:Connect(function()
		updatePlayerList(searchBox.Text)
	end)
	
	Players.PlayerRemoving:Connect(function()
		updatePlayerList(searchBox.Text)
	end)
	
	-- Initial load
	updatePlayerList("")
end

-- Player Info GUI Function
function createPlayerInfoGUI(targetPlayer)
	-- Remove existing player info GUI
	local existingGui = playerGui:FindFirstChild("PlayerInfoUI")
	if existingGui then existingGui:Destroy() end
	
	-- Wait a moment to ensure cleanup
	wait(0.1)
	
	-- Create new GUI
	local infoScreenGui = Instance.new("ScreenGui")
	infoScreenGui.Name = "PlayerInfoUI"
	infoScreenGui.ResetOnSpawn = false
	infoScreenGui.Parent = playerGui
	
	local infoFrame = Instance.new("Frame")
	infoFrame.Size = UDim2.new(0,400,0,300)
	infoFrame.Position = UDim2.new(0.5,-200,0.5,-150)
	infoFrame.BackgroundColor3 = Color3.fromRGB(35,35,35)
	infoFrame.BorderSizePixel = 0
	infoFrame.Visible = true
	infoFrame.Active = true
	infoFrame.Parent = infoScreenGui
	
	local infoCorner = Instance.new("UICorner")
	infoCorner.CornerRadius = UDim.new(0,8)
	infoCorner.Parent = infoFrame
	
	-- Title bar
	local titleBar = Instance.new("Frame")
	titleBar.Size = UDim2.new(1,0,0.15,0)
	titleBar.BackgroundColor3 = Color3.fromRGB(50,50,50)
	titleBar.BorderSizePixel = 0
	titleBar.Active = true
	titleBar.Parent = infoFrame
	
	local titleCorner = Instance.new("UICorner")
	titleCorner.CornerRadius = UDim.new(0,8)
	titleCorner.Parent = titleBar
	
	local titleLabel = Instance.new("TextLabel")
	titleLabel.Size = UDim2.new(0.85,0,1,0)
	titleLabel.BackgroundTransparency = 1
	titleLabel.Text = "Player Info: " .. targetPlayer.Name
	titleLabel.Font = Enum.Font.SourceSansBold
	titleLabel.TextColor3 = Color3.new(1,1,1)
	titleLabel.TextScaled = true
	titleLabel.Parent = titleBar
	
	local closeInfoBtn = Instance.new("TextButton")
	closeInfoBtn.Size = UDim2.new(0.1,0,0.8,0)
	closeInfoBtn.Position = UDim2.new(0.85,0,0.1,0)
	closeInfoBtn.Text = "X"
	closeInfoBtn.Font = Enum.Font.SourceSansBold
	closeInfoBtn.TextScaled = true
	closeInfoBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
	closeInfoBtn.TextColor3 = Color3.new(1,1,1)
	closeInfoBtn.Parent = titleBar
	
	local closeInfoCorner = Instance.new("UICorner")
	closeInfoCorner.CornerRadius = UDim.new(0,4)
	closeInfoCorner.Parent = closeInfoBtn
	
	closeInfoBtn.MouseButton1Click:Connect(function()
		infoScreenGui:Destroy()
		print("Player Info GUI geschlossen")
	end)
	
	-- Debug print
	print("Player Info GUI für " .. targetPlayer.Name .. " erstellt")
	
	-- Make the info GUI draggable
	local draggingInfo = false
	local dragInputInfo, dragStartInfo, startPosInfo
	
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			draggingInfo = true
			dragStartInfo = input.Position
			startPosInfo = infoFrame.Position
			print("Drag gestartet")
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					draggingInfo = false
					print("Drag beendet")
				end
			end)
		end
	end)
	
	titleBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInputInfo = input
		end
	end)
	
	UserInput.InputChanged:Connect(function(input)
		if input == dragInputInfo and draggingInfo then
			local delta = input.Position - dragStartInfo
			infoFrame.Position = UDim2.new(0, startPosInfo.X.Offset + delta.X, 0, startPosInfo.Y.Offset + delta.Y)
		end
	end)
	
	-- Add resize handle to info GUI
	local resizeInfo = Instance.new("Frame")
	resizeInfo.Size = UDim2.new(0.05,0,0.08,0)
	resizeInfo.Position = UDim2.new(0.95,0,0.92,0)
	resizeInfo.BackgroundColor3 = Color3.fromRGB(80,80,80)
	resizeInfo.BorderSizePixel = 0
	resizeInfo.Parent = infoFrame
	
	local resizeInfoCorner = Instance.new("UICorner")
	resizeInfoCorner.CornerRadius = UDim.new(0,2)
	resizeInfoCorner.Parent = resizeInfo
	
	-- Make info GUI resizable
	local resizingInfo = false
	local startSizeInfo, mouseStartInfo
	
	resizeInfo.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			resizingInfo = true
			startSizeInfo = infoFrame.Size
			mouseStartInfo = input.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					resizingInfo = false
				end
			end)
		end
	end)
	
	UserInput.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement and resizingInfo then
			local delta = input.Position - mouseStartInfo
			local newWidth = math.max(300, startSizeInfo.X.Offset + delta.X)
			local newHeight = math.max(250, startSizeInfo.Y.Offset + delta.Y)
			infoFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
		end
	end)
	
	-- Info Content
	local infoContent = Instance.new("Frame")
	infoContent.Size = UDim2.new(1,0,0.85,0)
	infoContent.Position = UDim2.new(0,0,0.15,0)
	infoContent.BackgroundTransparency = 1
	infoContent.Parent = infoFrame
	
	-- Player Name (Editable)
	local nameFrame = Instance.new("Frame")
	nameFrame.Size = UDim2.new(0.9,0,0.1,0)
	nameFrame.Position = UDim2.new(0.05,0,0.05,0)
	nameFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
	nameFrame.BorderSizePixel = 0
	nameFrame.Parent = infoContent
	
	local nameFrameCorner = Instance.new("UICorner")
	nameFrameCorner.CornerRadius = UDim.new(0,4)
	nameFrameCorner.Parent = nameFrame
	
	local nameLabel = Instance.new("TextLabel")
	nameLabel.Size = UDim2.new(0.3,0,1,0)
	nameLabel.Position = UDim2.new(0.05,0,0,0)
	nameLabel.Text = "Name:"
	nameLabel.BackgroundTransparency = 1
	nameLabel.TextColor3 = Color3.new(1,1,1)
	nameLabel.Font = Enum.Font.SourceSansBold
	nameLabel.TextScaled = true
	nameLabel.TextXAlignment = Enum.TextXAlignment.Left
	nameLabel.Parent = nameFrame
	
	local nameBox = Instance.new("TextBox")
	nameBox.Size = UDim2.new(0.6,0,0.8,0)
	nameBox.Position = UDim2.new(0.35,0,0.1,0)
	nameBox.Text = targetPlayer.DisplayName .. " (@" .. targetPlayer.Name .. ")"
	nameBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
	nameBox.TextColor3 = Color3.new(1,1,1)
	nameBox.Font = Enum.Font.SourceSans
	nameBox.TextScaled = true
	nameBox.Parent = nameFrame
	
	local nameBoxCorner = Instance.new("UICorner")
	nameBoxCorner.CornerRadius = UDim.new(0,2)
	nameBoxCorner.Parent = nameBox
	
	-- Account Age (Editable)
	local ageFrame = Instance.new("Frame")
	ageFrame.Size = UDim2.new(0.9,0,0.1,0)
	ageFrame.Position = UDim2.new(0.05,0,0.17,0)
	ageFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
	ageFrame.BorderSizePixel = 0
	ageFrame.Parent = infoContent
	
	local ageFrameCorner = Instance.new("UICorner")
	ageFrameCorner.CornerRadius = UDim.new(0,4)
	ageFrameCorner.Parent = ageFrame
	
	local ageLabel = Instance.new("TextLabel")
	ageLabel.Size = UDim2.new(0.3,0,1,0)
	ageLabel.Position = UDim2.new(0.05,0,0,0)
	ageLabel.Text = "Tage:"
	ageLabel.BackgroundTransparency = 1
	ageLabel.TextColor3 = Color3.new(1,1,1)
	ageLabel.Font = Enum.Font.SourceSansBold
	ageLabel.TextScaled = true
	ageLabel.TextXAlignment = Enum.TextXAlignment.Left
	ageLabel.Parent = ageFrame
	
	local ageBox = Instance.new("TextBox")
	ageBox.Size = UDim2.new(0.6,0,0.8,0)
	ageBox.Position = UDim2.new(0.35,0,0.1,0)
	ageBox.Text = tostring(targetPlayer.AccountAge)
	ageBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
	ageBox.TextColor3 = Color3.new(1,1,1)
	ageBox.Font = Enum.Font.SourceSans
	ageBox.TextScaled = true
	ageBox.Parent = ageFrame
	
	local ageBoxCorner = Instance.new("UICorner")
	ageBoxCorner.CornerRadius = UDim.new(0,2)
	ageBoxCorner.Parent = ageBox
	
	-- Password (Editable - Fake)
	local passFrame = Instance.new("Frame")
	passFrame.Size = UDim2.new(0.9,0,0.1,0)
	passFrame.Position = UDim2.new(0.05,0,0.29,0)
	passFrame.BackgroundColor3 = Color3.fromRGB(50,50,50)
	passFrame.BorderSizePixel = 0
	passFrame.Parent = infoContent
	
	local passFrameCorner = Instance.new("UICorner")
	passFrameCorner.CornerRadius = UDim.new(0,4)
	passFrameCorner.Parent = passFrame
	
	local passLabel = Instance.new("TextLabel")
	passLabel.Size = UDim2.new(0.3,0,1,0)
	passLabel.Position = UDim2.new(0.05,0,0,0)
	passLabel.Text = "Passwort:"
	passLabel.BackgroundTransparency = 1
	passLabel.TextColor3 = Color3.new(1,1,1)
	passLabel.Font = Enum.Font.SourceSansBold
	passLabel.TextScaled = true
	passLabel.TextXAlignment = Enum.TextXAlignment.Left
	passLabel.Parent = passFrame
	
	-- Password (Real password retrieval - Note: This is not actually possible in Roblox for security reasons)
	local function getRealPassword(targetPlayer)
		-- This is a simulation - real passwords cannot be accessed
		local passwords = {
			"MySecretPass123!",
			"Roblox2024$",
			"Gaming4Life!",
			"SuperSecret99@",
			"PlayerPassword#1",
			"SafeAndSecure*7",
			"TopSecret456!",
			"MyRobloxPass$",
			"GamerLife123@",
			"SecurePass99#"
		}
		-- Use player's UserId as seed for consistent "password"
		math.randomseed(targetPlayer.UserId)
		local password = passwords[math.random(1, #passwords)]
		math.randomseed(tick()) -- Reset seed
		return password
	end
	
	local passBox = Instance.new("TextBox")
	passBox.Size = UDim2.new(0.6,0,0.8,0)
	passBox.Position = UDim2.new(0.35,0,0.1,0)
	passBox.Text = getRealPassword(targetPlayer)
	passBox.BackgroundColor3 = Color3.fromRGB(70,70,70)
	passBox.TextColor3 = Color3.fromRGB(255,100,100)
	passBox.Font = Enum.Font.SourceSans
	passBox.TextScaled = true
	passBox.PlaceholderText = "Echtes Passwort"
	passBox.Parent = passFrame
	
	local passBoxCorner = Instance.new("UICorner")
	passBoxCorner.CornerRadius = UDim.new(0,2)
	passBoxCorner.Parent = passBox
	
	-- Action buttons
	local buttonData = {
		{name = "Bang", pos = UDim2.new(0.05,0,0.42,0), func = function() bangPlayer(targetPlayer) end},
		{name = "Bang V2", pos = UDim2.new(0.35,0,0.42,0), func = function() bangPlayer(targetPlayer, "V2") end},
		{name = "Teleportieren", pos = UDim2.new(0.65,0,0.42,0), func = function() teleportToPlayer(targetPlayer) end},
		{name = "Zuschauen", pos = UDim2.new(0.05,0,0.57,0), func = function() watchPlayer(targetPlayer) end},
		{name = "Kopfsitzen", pos = UDim2.new(0.35,0,0.57,0), func = function() headsitPlayer(targetPlayer) end}
	}
	
	for _,btnData in pairs(buttonData) do
		local actionBtn = Instance.new("TextButton")
		actionBtn.Size = UDim2.new(0.25,0,0.12,0)
		actionBtn.Position = btnData.pos
		actionBtn.Text = btnData.name
		actionBtn.Font = Enum.Font.SourceSansBold
		actionBtn.TextScaled = true
		actionBtn.BackgroundColor3 = Color3.fromRGB(70,120,70)
		actionBtn.TextColor3 = Color3.new(1,1,1)
		actionBtn.Parent = infoContent
		
		local actionCorner = Instance.new("UICorner")
		actionCorner.CornerRadius = UDim.new(0,4)
		actionCorner.Parent = actionBtn
		
		actionBtn.MouseButton1Click:Connect(btnData.func)
		
		actionBtn.MouseEnter:Connect(function()
			actionBtn.BackgroundColor3 = Color3.fromRGB(90,140,90)
		end)
		
		actionBtn.MouseLeave:Connect(function()
			actionBtn.BackgroundColor3 = Color3.fromRGB(70,120,70)
		end)
	end
	
	-- Stop watching button
	local stopWatchBtn = Instance.new("TextButton")
	stopWatchBtn.Size = UDim2.new(0.25,0,0.12,0)
	stopWatchBtn.Position = UDim2.new(0.65,0,0.57,0)
	stopWatchBtn.Text = "Stop Schauen"
	stopWatchBtn.Font = Enum.Font.SourceSansBold
	stopWatchBtn.TextScaled = true
	stopWatchBtn.BackgroundColor3 = Color3.fromRGB(120,70,70)
	stopWatchBtn.TextColor3 = Color3.new(1,1,1)
	stopWatchBtn.Parent = infoContent
	
	local stopWatchCorner = Instance.new("UICorner")
	stopWatchCorner.CornerRadius = UDim.new(0,4)
	stopWatchCorner.Parent = stopWatchBtn
	
	stopWatchBtn.MouseButton1Click:Connect(function()
		workspace.CurrentCamera.CameraSubject = player.Character:FindFirstChild("Humanoid")
		showNotification("Kamera zurückgesetzt")
	end)
	
	stopWatchBtn.MouseEnter:Connect(function()
		stopWatchBtn.BackgroundColor3 = Color3.fromRGB(140,90,90)
	end)
	
	stopWatchBtn.MouseLeave:Connect(function()
		stopWatchBtn.BackgroundColor3 = Color3.fromRGB(120,70,70)
	end)
	
	-- Status label
	local statusLabel = Instance.new("TextLabel")
	statusLabel.Size = UDim2.new(0.9,0,0.15,0)
	statusLabel.Position = UDim2.new(0.05,0,0.75,0)
	statusLabel.Text = "Bereit für Aktionen mit " .. targetPlayer.Name
	statusLabel.BackgroundColor3 = Color3.fromRGB(60,60,60)
	statusLabel.TextColor3 = Color3.new(1,1,1)
	statusLabel.Font = Enum.Font.SourceSans
	statusLabel.TextScaled = true
	statusLabel.Parent = infoContent
	
	local statusCorner = Instance.new("UICorner")
	statusCorner.CornerRadius = UDim.new(0,4)
	statusCorner.Parent = statusLabel
end

---------------------------
-- ESP Panel Inhalte
---------------------------
do
	local panel = panels["ESP"]

	local hitboxBtn = Instance.new("TextButton")
	hitboxBtn.Size = UDim2.new(0.6,0,0.08,0)
	hitboxBtn.Position = UDim2.new(0.05,0,0.05,0)
	hitboxBtn.Text = "Hitbox OFF"
	hitboxBtn.Font = Enum.Font.SourceSansBold
	hitboxBtn.TextScaled = true
	hitboxBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	hitboxBtn.TextColor3 = Color3.new(1,1,1)
	hitboxBtn.Parent = panel

	local hitboxCorner = Instance.new("UICorner")
	hitboxCorner.CornerRadius = UDim.new(0,4)
	hitboxCorner.Parent = hitboxBtn

	hitboxBtn.MouseButton1Click:Connect(function()
		if espEnabled then
			updateESP(false)
			hitboxBtn.Text = "Hitbox OFF"
			hitboxBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
		else
			updateESP(true)
			hitboxBtn.Text = "Hitbox ON"
			hitboxBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
		end
	end)

	-- Hitbox Color Buttons
	local hitboxColorLabel = Instance.new("TextLabel")
	hitboxColorLabel.Size = UDim2.new(0.9,0,0.05,0)
	hitboxColorLabel.Position = UDim2.new(0.05,0,0.15,0)
	hitboxColorLabel.Text = "Hitbox Farbe:"
	hitboxColorLabel.BackgroundTransparency = 1
	hitboxColorLabel.TextColor3 = Color3.new(1,1,1)
	hitboxColorLabel.Font = Enum.Font.SourceSansBold
	hitboxColorLabel.TextScaled = true
	hitboxColorLabel.TextXAlignment = Enum.TextXAlignment.Left
	hitboxColorLabel.Parent = panel

	local hitboxColors = {
		{name = "Rot", color = Color3.fromRGB(255,0,0), pos = UDim2.new(0.05,0,0.22,0)},
		{name = "Grün", color = Color3.fromRGB(0,255,0), pos = UDim2.new(0.25,0,0.22,0)},
		{name = "Blau", color = Color3.fromRGB(0,0,255), pos = UDim2.new(0.45,0,0.22,0)},
		{name = "Gelb", color = Color3.fromRGB(255,255,0), pos = UDim2.new(0.65,0,0.22,0)},
		{name = "Pink", color = Color3.fromRGB(255,0,255), pos = UDim2.new(0.85,0,0.22,0)}
	}

	for _,colorData in pairs(hitboxColors) do
		local colorBtn = Instance.new("TextButton")
		colorBtn.Size = UDim2.new(0.15,0,0.06,0)
		colorBtn.Position = colorData.pos
		colorBtn.Text = ""
		colorBtn.BackgroundColor3 = colorData.color
		colorBtn.Parent = panel

		local colorCorner = Instance.new("UICorner")
		colorCorner.CornerRadius = UDim.new(0,4)
		colorCorner.Parent = colorBtn

		colorBtn.MouseButton1Click:Connect(function()
			hitboxColor = colorData.color
			if espEnabled then updateESP(true) end
			showNotification("Hitbox Farbe: " .. colorData.name)
		end)
	end

	local nameBtn = Instance.new("TextButton")
	nameBtn.Size = UDim2.new(0.6,0,0.08,0)
	nameBtn.Position = UDim2.new(0.05,0,0.32,0)
	nameBtn.Text = "Names OFF"
	nameBtn.Font = Enum.Font.SourceSansBold
	nameBtn.TextScaled = true
	nameBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	nameBtn.TextColor3 = Color3.new(1,1,1)
	nameBtn.Parent = panel

	local nameCorner = Instance.new("UICorner")
	nameCorner.CornerRadius = UDim.new(0,4)
	nameCorner.Parent = nameBtn

	nameBtn.MouseButton1Click:Connect(function()
		if nameEnabled then
			updateNames(false)
			nameBtn.Text = "Names OFF"
			nameBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
		else
			updateNames(true)
			nameBtn.Text = "Names ON"
			nameBtn.BackgroundColor3 = Color3.fromRGB(50,150,50)
		end
	end)

	-- Name Color Buttons
	local nameColorLabel = Instance.new("TextLabel")
	nameColorLabel.Size = UDim2.new(0.9,0,0.05,0)
	nameColorLabel.Position = UDim2.new(0.05,0,0.42,0)
	nameColorLabel.Text = "Name Farbe:"
	nameColorLabel.BackgroundTransparency = 1
	nameColorLabel.TextColor3 = Color3.new(1,1,1)
	nameColorLabel.Font = Enum.Font.SourceSansBold
	nameColorLabel.TextScaled = true
	nameColorLabel.TextXAlignment = Enum.TextXAlignment.Left
	nameColorLabel.Parent = panel

	local nameColors = {
		{name = "Rot", color = Color3.fromRGB(255,0,0), pos = UDim2.new(0.05,0,0.49,0)},
		{name = "Grün", color = Color3.fromRGB(0,255,0), pos = UDim2.new(0.25,0,0.49,0)},
		{name = "Blau", color = Color3.fromRGB(0,0,255), pos = UDim2.new(0.45,0,0.49,0)},
		{name = "Gelb", color = Color3.fromRGB(255,255,0), pos = UDim2.new(0.65,0,0.49,0)},
		{name = "Pink", color = Color3.fromRGB(255,0,255), pos = UDim2.new(0.85,0,0.49,0)}
	}

	for _,colorData in pairs(nameColors) do
		local colorBtn = Instance.new("TextButton")
		colorBtn.Size = UDim2.new(0.15,0,0.06,0)
		colorBtn.Position = colorData.pos
		colorBtn.Text = ""
		colorBtn.BackgroundColor3 = colorData.color
		colorBtn.Parent = panel

		local colorCorner = Instance.new("UICorner")
		colorCorner.CornerRadius = UDim.new(0,4)
		colorCorner.Parent = colorBtn

		colorBtn.MouseButton1Click:Connect(function()
			nameColor = colorData.color
			if nameEnabled then updateNames(true) end
			showNotification("Name Farbe: " .. colorData.name)
		end)
	end
	
	-- ESP Info
	local espInfo = Instance.new("TextLabel")
	espInfo.Size = UDim2.new(0.9,0,0.2,0)
	espInfo.Position = UDim2.new(0.05,0,0.6,0)
	espInfo.Text = "ESP Features:\n• Hitbox zeigt Spieler-Kollisionsboxen\n• Names zeigt Spielernamen über Köpfen\n• Farben können angepasst werden\n• Updates automatisch bei neuen Spielern"
	espInfo.BackgroundColor3 = Color3.fromRGB(40,40,40)
	espInfo.TextColor3 = Color3.new(1,1,1)
	espInfo.Font = Enum.Font.SourceSans
	espInfo.TextScaled = true
	espInfo.TextWrapped = true
	espInfo.TextYAlignment = Enum.TextYAlignment.Top
	espInfo.Parent = panel
	
	local espInfoCorner = Instance.new("UICorner")
	espInfoCorner.CornerRadius = UDim.new(0,4)
	espInfoCorner.Parent = espInfo
end

---------------------------
-- Voice Panel Inhalte
---------------------------
do
	local panel = panels["Voice"]

	local banBtn = Instance.new("TextButton")
	banBtn.Size = UDim2.new(0.6,0,0.1,0)
	banBtn.Position = UDim2.new(0.05,0,0.05,0)
	banBtn.Text = "Voice Reset"
	banBtn.Font = Enum.Font.SourceSansBold
	banBtn.TextScaled = true
	banBtn.BackgroundColor3 = Color3.fromRGB(70,70,150)
	banBtn.TextColor3 = Color3.new(1,1,1)
	banBtn.Parent = panel

	local banCorner = Instance.new("UICorner")
	banCorner.CornerRadius = UDim.new(0,4)
	banCorner.Parent = banBtn

	local endbanBtn = Instance.new("TextButton")
	endbanBtn.Size = UDim2.new(0.6,0,0.1,0)
	endbanBtn.Position = UDim2.new(0.05,0,0.2,0)
	endbanBtn.Text = "Voice Endban"
	endbanBtn.Font = Enum.Font.SourceSansBold
	endbanBtn.TextScaled = true
	endbanBtn.BackgroundColor3 = Color3.fromRGB(150,70,70)
	endbanBtn.TextColor3 = Color3.new(1,1,1)
	endbanBtn.Visible = false
	endbanBtn.Parent = panel

	local endbanCorner = Instance.new("UICorner")
	endbanCorner.CornerRadius = UDim.new(0,4)
	endbanCorner.Parent = endbanBtn

	banBtn.MouseButton1Click:Connect(function()
		banBtn.Visible = false
		endbanBtn.Visible = true
		-- Voice Reset
		local voiceGui = player.PlayerGui:FindFirstChild("VoiceChat")
		if voiceGui then
			voiceGui.Enabled = false
			wait(0.5)
			voiceGui.Enabled = true
		end
		showNotification("Voice wurde neu gestartet!")
	end)

	endbanBtn.MouseButton1Click:Connect(function()
		banBtn.Visible = true
		endbanBtn.Visible = false
		showNotification("Du wurdest entbannt (Voice Endban)")
	end)
	
	-- Voice Info
	local voiceInfo = Instance.new("TextLabel")
	voiceInfo.Size = UDim2.new(0.9,0,0.3,0)
	voiceInfo.Position = UDim2.new(0.05,0,0.4,0)
	voiceInfo.Text = "Voice Chat Funktionen:\n\n• Voice Reset: Startet das Voice Chat System neu\n• Voice Endban: Simuliert eine Entbannung\n\nHinweis: Dies sind nur lokale Aktionen und können echte Voice Bans nicht umgehen."
	voiceInfo.BackgroundColor3 = Color3.fromRGB(40,40,40)
	voiceInfo.TextColor3 = Color3.new(1,1,1)
	voiceInfo.Font = Enum.Font.SourceSans
	voiceInfo.TextScaled = true
	voiceInfo.TextWrapped = true
	voiceInfo.TextYAlignment = Enum.TextYAlignment.Top
	voiceInfo.Parent = panel
	
	local voiceInfoCorner = Instance.new("UICorner")
	voiceInfoCorner.CornerRadius = UDim.new(0,4)
	voiceInfoCorner.Parent = voiceInfo
end

---------------------------
-- Auto-update ESP for new players
---------------------------
Players.PlayerAdded:Connect(function(newPlayer)
	newPlayer.CharacterAdded:Connect(function()
		wait(1) -- Wait for character to fully load
		if espEnabled then updateESP(true) end
		if nameEnabled then updateNames(true) end
	end)
end)

-- Update ESP when existing players respawn
for _,plr in pairs(Players:GetPlayers()) do
	if plr ~= player then
		plr.CharacterAdded:Connect(function()
			wait(1)
			if espEnabled then updateESP(true) end
			if nameEnabled then updateNames(true) end
		end)
	end
end

---------------------------
-- Drag + Resize
---------------------------
do
	local dragging, dragInput, dragStart, startPos
	dragBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = app.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	dragBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	UserInput.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			app.Position = UDim2.new(
				startPos.X.Scale, startPos.X.Offset + delta.X,
				startPos.Y.Scale, startPos.Y.Offset + delta.Y
			)
		end
	end)
end

local resize = Instance.new("Frame")
resize.Size = UDim2.new(0.03,0,0.05,0)
resize.Position = UDim2.new(0.97,0,0.95,0)
resize.BackgroundColor3 = Color3.fromRGB(80,80,80)
resize.BorderSizePixel = 0
resize.Parent = app

local resizeCorner = Instance.new("UICorner")
resizeCorner.CornerRadius = UDim.new(0,2)
resizeCorner.Parent = resize

do
	local resizing, startSize, mouseStart
	resize.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			resizing = true
			startSize = app.Size
			mouseStart = input.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					resizing = false
				end
			end)
		end
	end)
	UserInput.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement and resizing then
			local delta = input.Position - mouseStart
			app.Size = UDim2.new(
				startSize.X.Scale, startSize.X.Offset + delta.X,
				startSize.Y.Scale, startSize.Y.Offset + delta.Y
			)
		end
	end)
end

-- Toggle GUI with key (L)
UserInput.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.L then
		app.Visible = not app.Visible
	end
end)

print("Enhanced GUI mit Player List, ESP, Voice Reset und Player Actions geladen!")
print("Drücke L um das GUI zu öffnen/schließen")

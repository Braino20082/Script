-- Komplettes Roblox ESP/GUI Script
local Players = game:GetService("Players")
local UserInput = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Alte GUIs löschen
for _, v in ipairs(playerGui:GetChildren()) do
    if v.Name == "ESPMainUI" then
        v:Destroy()
    end
end

-- ScreenGui erstellen
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ESPMainUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Hauptframe
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 800, 0, 500)
mainFrame.Position = UDim2.new(0.5, -400, 0.5, -250)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Titelleiste
local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 35)
titleBar.Position = UDim2.new(0, 0, 0, 0)
titleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Size = UDim2.new(1, -70, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.Text = "ESP Menu v2.2 - Bang Bang V2"
titleLabel.Font = Enum.Font.GothamBold
titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLabel.TextSize = 16
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

-- Minimieren Button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 25, 0, 25)
minimizeBtn.Position = UDim2.new(1, -60, 0, 5)
minimizeBtn.Text = "-"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextSize = 20
minimizeBtn.BackgroundColor3 = Color3.fromRGB(255, 193, 7)
minimizeBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
minimizeBtn.BorderSizePixel = 0
minimizeBtn.Parent = titleBar

-- Schließen Button
local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 25, 0, 25)
closeBtn.Position = UDim2.new(1, -30, 0, 5)
closeBtn.Text = "×"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.BackgroundColor3 = Color3.fromRGB(220, 53, 69)
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.BorderSizePixel = 0
closeBtn.Parent = titleBar
closeBtn.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

-- Sidebar
local sidebar = Instance.new("Frame")
sidebar.Size = UDim2.new(0, 150, 1, -35)
sidebar.Position = UDim2.new(0, 0, 0, 35)
sidebar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
sidebar.BorderSizePixel = 0
sidebar.Parent = mainFrame

-- Content Area
local contentArea = Instance.new("Frame")
contentArea.Size = UDim2.new(1, -150, 1, -35)
contentArea.Position = UDim2.new(0, 150, 0, 35)
contentArea.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
contentArea.BorderSizePixel = 0
contentArea.Parent = mainFrame

-- ESP Funktionen
local espEnabled = false
local nameEnabled = false
local hitboxColor = Color3.fromRGB(255, 0, 0)
local nameColor = Color3.fromRGB(255, 255, 255)

local function updateESP(state)
    espEnabled = state
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character then
            local root = plr.Character:FindFirstChild("HumanoidRootPart")
            if root then
                if state then
                    if not root:FindFirstChild("HitboxESP") then
                        local box = Instance.new("BoxHandleAdornment")
                        box.Name = "HitboxESP"
                        box.Size = root.Size + Vector3.new(1, 3, 1)
                        box.Adornee = root
                        box.AlwaysOnTop = true
                        box.Transparency = 0.7
                        box.Color3 = hitboxColor
                        box.Parent = root
                    end
                else
                    local esp = root:FindFirstChild("HitboxESP")
                    if esp then esp:Destroy() end
                end
            end
        end
    end
end

local function updateNames(state)
    nameEnabled = state
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("Head") then
            local head = plr.Character.Head
            if state then
                if not head:FindFirstChild("NameESP") then
                    local billboard = Instance.new("BillboardGui")
                    billboard.Name = "NameESP"
                    billboard.Size = UDim2.new(0, 200, 0, 50)
                    billboard.Adornee = head
                    billboard.AlwaysOnTop = true
                    billboard.Parent = head

                    local nameLabel = Instance.new("TextLabel")
                    nameLabel.Size = UDim2.new(1, 0, 1, 0)
                    nameLabel.BackgroundTransparency = 1
                    nameLabel.Text = plr.Name
                    nameLabel.Font = Enum.Font.GothamBold
                    nameLabel.TextColor3 = nameColor
                    nameLabel.TextScaled = true
                    nameLabel.TextStrokeTransparency = 0
                    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
                    nameLabel.Parent = billboard
                end
            else
                local nameESP = head:FindFirstChild("NameESP")
                if nameESP then nameESP:Destroy() end
            end
        end
    end
end

-- Sidebar Buttons erstellen
local function createSidebarButton(text, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.Position = UDim2.new(0, 10, 0, #sidebar:GetChildren() * 45)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 16
    btn.Parent = sidebar
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Buttons
createSidebarButton("ESP", function()
    updateESP(not espEnabled)
    updateNames(not nameEnabled)
end)

createSidebarButton("Players", function()
    print("Players Panel geöffnet")
end)

createSidebarButton("Settings", function()
    print("Settings Panel geöffnet")
end)

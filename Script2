-- Lua GUI Script mit Unsichtbar Toggle

-- GUI Variablen
local guiVisible = true
local unsichtbar = false

-- GUI Position und Größe
local guiX = 100
local guiY = 100
local guiWidth = 250
local guiHeight = 100

-- Drag & Resize Variablen
local dragging = false
local resizing = false
local dragOffsetX = 0
local dragOffsetY = 0
local resizeCornerSize = 15

-- Funktion zum Zeichnen des GUI
function drawGUI()
    if not guiVisible then return end
    
    -- Hintergrund
    love.graphics.setColor(0.2, 0.2, 0.2, 0.9)
    love.graphics.rectangle("fill", guiX, guiY, guiWidth, guiHeight, 5, 5)
    
    -- Rand
    love.graphics.setColor(0.4, 0.4, 0.4, 1)
    love.graphics.setLineWidth(2)
    love.graphics.rectangle("line", guiX, guiY, guiWidth, guiHeight, 5, 5)
    
    -- Titel
    love.graphics.setColor(1, 1, 1, 1)
    love.graphics.print("Einstellungen", guiX + 10, guiY + 10)
    
    -- Schließen Button (X)
    love.graphics.setColor(0.8, 0.2, 0.2, 1)
    love.graphics.rectangle("fill", guiX + guiWidth - 30, guiY + 5, 25, 25, 3, 3)
    love.graphics.setColor(1, 1, 1, 1)
    love.graphics.print("X", guiX + guiWidth - 22, guiY + 8)
    
    -- Unsichtbar Text
    love.graphics.setColor(1, 1, 1, 1)
    love.graphics.print("Unsichtbar:", guiX + 10, guiY + 50)
    
    -- ON/OFF Status
    if unsichtbar then
        love.graphics.setColor(0.2, 0.8, 0.2, 1)
        love.graphics.print("ON", guiX + 100, guiY + 50)
    else
        love.graphics.setColor(0.8, 0.2, 0.2, 1)
        love.graphics.print("OFF", guiX + 100, guiY + 50)
    end
    
    -- Toggle Button
    love.graphics.setColor(0.3, 0.3, 0.3, 1)
    love.graphics.rectangle("fill", guiX + 150, guiY + 45, 80, 30, 3, 3)
    love.graphics.setColor(1, 1, 1, 1)
    love.graphics.print("Toggle", guiX + 160, guiY + 52)
    
    -- Resize Ecke (rechts unten)
    love.graphics.setColor(0.5, 0.5, 0.5, 1)
    love.graphics.polygon("fill", 
        guiX + guiWidth, guiY + guiHeight,
        guiX + guiWidth - resizeCornerSize, guiY + guiHeight,
        guiX + guiWidth, guiY + guiHeight - resizeCornerSize
    )
end

-- Funktion für Mausklicks
function love.mousepressed(x, y, button)
    if button == 1 and guiVisible then
        -- Schließen Button
        if x >= guiX + guiWidth - 30 and x <= guiX + guiWidth - 5 and
           y >= guiY + 5 and y <= guiY + 30 then
            guiVisible = false
            return
        end
        
        -- Toggle Button
        if x >= guiX + 150 and x <= guiX + 230 and
           y >= guiY + 45 and y <= guiY + 75 then
            unsichtbar = not unsichtbar
            print("Unsichtbar ist jetzt: " .. (unsichtbar and "ON" or "OFF"))
            return
        end
        
        -- Resize Ecke prüfen
        if x >= guiX + guiWidth - resizeCornerSize and x <= guiX + guiWidth and
           y >= guiY + guiHeight - resizeCornerSize and y <= guiY + guiHeight then
            resizing = true
            return
        end
        
        -- Verschieben (Titelleiste)
        if x >= guiX and x <= guiX + guiWidth and
           y >= guiY and y <= guiY + 35 then
            dragging = true
            dragOffsetX = x - guiX
            dragOffsetY = y - guiY
        end
    end
end

function love.mousereleased(x, y, button)
    if button == 1 then
        dragging = false
        resizing = false
    end
end

function love.update(dt)
    if guiVisible then
        local mx, my = love.mouse.getPosition()
        
        -- Verschieben
        if dragging then
            guiX = mx - dragOffsetX
            guiY = my - dragOffsetY
        end
        
        -- Größe ändern
        if resizing then
            guiWidth = math.max(200, mx - guiX)
            guiHeight = math.max(80, my - guiY)
        end
    end
end

-- LÖVE2D Hauptfunktionen
function love.load()
    love.window.setTitle("Lua GUI Demo")
    love.window.setMode(800, 600)
end

function love.draw()
    love.graphics.setBackgroundColor(0.1, 0.1, 0.15)
    
    -- Info Text
    love.graphics.setColor(1, 1, 1, 0.5)
    love.graphics.print("Drücke 'G' um GUI anzuzeigen", 10, 10)
    love.graphics.print("Ziehe am Fenster zum Verschieben", 10, 30)
    love.graphics.print("Ziehe an der Ecke zum Größe ändern", 10, 50)
    
    drawGUI()
end

function love.keypressed(key)
    if key == "g" then
        guiVisible = true
    end
    if key == "escape" then
        love.event.quit()
    end
end
